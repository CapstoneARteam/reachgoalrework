(this["webpackJsonpar-app"]=this["webpackJsonpar-app"]||[]).push([[0],{198:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return O}));var a=n(57),i=n(114),o=n(280),l=n(36),r=n(0),c=n.n(r),s=n(440),u=n(909),d=n(910),m=n(908),p=(n(168),n(15)),h=n(208),f=n(89),b=n(55),g=n(210),v=n(212),_=n(52),E=n(56),y={},x={position:"fixed",width:"60px",height:"60px",bottom:"40px",right:"40px",backgroundColor:"#0C9",color:"#FFF",borderRadius:"50px",textAlign:"center",boxShadow:"2px 2px 3px #999",zIndex:1500},w=function(t,n){var a=t.replace(/^data:image\/\w+;base64,/,""),i=new e(a,"base64"),o=new p.a.Binary(new Uint8Array(i),0),l=E.a.getServiceClient(h.b.factory,"capstoneusercontent"),r={ACL:"public-read",Bucket:"capstoneusercontent",ContentType:"image/jpeg",Key:n+".jpeg",ContentEncoding:"base64",Body:o},c=(new h.a.Builder).withService("s3").withAction("PutObject").withRegion("us-west-2").withArgs(r);l.execute(c.build()).then((function(e){console.log(e)})).catch((function(e){console.log(e)}))},k=function(e){return c.a.createElement("div",null,c.a.createElement("input",{type:"file",multiple:"single",onChange:function(t){!function(e,t){var n=new FileReader;n.readAsDataURL(t.target.files[0]),n.onloadend=function(t){return e.setbase64data(t.target.result),t.target.result}}(e,t)}}),c.a.createElement("img",{style:{height:"200px",width:"300px"},src:e.base64data}))},O=function(e){var t=Object(r.useState)(e.pin),n=Object(l.a)(t,2),a=n[0],s=n[1],u=function(e){s(Object(o.a)(Object(o.a)({},a),{},Object(i.a)({},e.target.name,e.target.value)))},d=Object(r.useState)("https://capstoneusercontent.s3-us-west-2.amazonaws.com/"+e.id+".jpeg?versionid=latest&date="+Date.now()),m=Object(l.a)(d,2),p=m[0],h=m[1];return c.a.createElement(f.a,Object.assign({},e,{centered:!0,show:e.show,style:{zIndex:"1600"}}),c.a.createElement(f.a.Header,null,c.a.createElement(f.a.Title,null,"Edit a Pin")),c.a.createElement(f.a.Body,null,c.a.createElement(b.a,null,c.a.createElement(b.a.Group,null,c.a.createElement(b.a.Label,null,"Title"),c.a.createElement(b.a.Control,{type:"title",id:"title",name:"title",value:a.title,onChange:u})),c.a.createElement(b.a.Group,null,c.a.createElement(b.a.Label,null,"Description"),c.a.createElement(b.a.Control,{as:"textarea",rows:"2",id:"description",name:"description",value:a.description,onChange:u})),c.a.createElement(b.a.Group,null,c.a.createElement(b.a.Label,null,"Hint"),c.a.createElement(b.a.Control,{as:"textarea",rows:"2",id:"hint",name:"hint",value:a.hint,onChange:u})),c.a.createElement(b.a.Group,null,c.a.createElement(b.a.Label,null,"Destination"),c.a.createElement(b.a.Control,{id:"destination",name:"destination",value:a.destination,onChange:u})),c.a.createElement(b.a.Group,null,c.a.createElement(k,{base64data:e.base64data,setbase64data:e.setbase64data,imgurl:p,setimgurl:h}),c.a.createElement("img",{style:{height:"200px",width:"300px"},src:p})))),c.a.createElement(f.a.Footer,null,c.a.createElement(g.a,{variant:"secondary",onClick:e.cancel},"Cancel"),c.a.createElement(g.a,{variant:"primary",onClick:function(){e.save(a)}},"Submit")))},j=function(e){var t=Object(r.useState)(!1),n=Object(l.a)(t,2),a=n[0],i=n[1],o=Object(r.useState)("default"),u=Object(l.a)(o,2),d=u[0],m=u[1];return c.a.createElement(s.a,{key:y,position:e.pin.coords,onClick:function(){i(!a)}},c.a.createElement(O,{pin:e.pin,id:e.pin._id,show:a,save:function(e){var t={_id:e._id},n={$set:e};E.b.collection("PINS").findOneAndUpdate(t,n).then((function(e){"default"===d||w(d,e._id.toString()),i(!1)}))},cancel:function(){return i(!1)},setbase64data:m,base64data:d}))},S=function(e){var t=Object(r.useState)({hint:"",description:""}),n=Object(l.a)(t,2),i=n[0],o=n[1],s=Object(r.useState)([]),u=Object(l.a)(s,2),d=u[0],m=u[1];return Object(r.useEffect)((function(){E.b.collection("CATEGORIES").find({}).asArray().then(m)}),[]),c.a.createElement(f.a,Object.assign({},e,{centered:!0,style:{zIndex:"1600"}}),c.a.createElement(f.a.Header,null,c.a.createElement(f.a.Title,null,"Add a Pin")),c.a.createElement(f.a.Body,null,c.a.createElement(b.a.Group,null,c.a.createElement(b.a.Label,null,"Category"),c.a.createElement(v.a,{onSelect:function(e){o(JSON.parse(e))}},c.a.createElement(v.a.Toggle,{variant:"secondary",id:"dropdown-basic"},"Dropdown Button"),c.a.createElement(v.a.Menu,null,d.map((function(e){var t={description:e.description,hint:e.hint};return c.a.createElement(v.a.Item,{eventKey:JSON.stringify(t)},e.title)}))))),c.a.createElement("label",{className:"d-block",htmlFor:"title"},"Title"),c.a.createElement("input",{type:"text",className:"w-100",id:"title",required:!0}),c.a.createElement("label",{className:"d-block",htmlFor:"description"},"Description"),c.a.createElement("textarea",{className:"w-100",id:"description",placeHolder:i.description,required:!0}),c.a.createElement("label",{className:"d-block",htmlFor:"hint"},"Hint"),c.a.createElement("textarea",{className:"w-100",id:"hint",placeHolder:i.hint,required:!0}),c.a.createElement("label",{className:"d-block",htmlFor:"destination"},"Student Feedback"),c.a.createElement("textarea",{className:"w-100",id:"destination",required:!0}),c.a.createElement("label",{className:"d-block",htmlFor:"pinImage"},"Image"),c.a.createElement(k,{base64data:e.base64data,setbase64data:e.setbase64data}," ")),c.a.createElement(f.a.Footer,null,c.a.createElement("button",{className:"btn btn-secondary",onClick:e.onHide},"Cancel"),c.a.createElement("button",{className:"btn btn-primary",onClick:function(){var t=document.getElementById("title").value||"",n=document.getElementById("hint").value||"",i=document.getElementById("description").value||"",o=document.getElementById("destination").value||"",l=y,r=l.lng,s=l.lat,u={title:t,owner_id:E.a.auth.authInfo.userId,description:i,hint:n,destination:o,audio:"",video:"",coords:[s,r]};E.b.collection("PINS").insertOne(u).then((function(l){"default"===e.base64data||w(e.base64data,l.insertedId.toString()),e.setMarkers([].concat(Object(a.a)(e.markers),[c.a.createElement(j,{id:l.insertedId.toString(),description:i,hint:n,destination:o,title:t,objectID:l.insertedId,lng:r,lat:s,key:l.insertedId,pin:u})]));var d=e.module;d.pins=[].concat(Object(a.a)(d.pins),[l.insertedId]),e.setModule(d);var m={_id:d._id},p={$set:{pins:d.pins}};E.b.collection("MODULES").findOneAndUpdate(m,p,{upsert:!1}).then((function(e){})).catch(console.error)})),e.onHide()}},"Submit")))};t.b=function(e){var t=Object(r.useState)([45,45]),n=Object(l.a)(t,2),a=n[0],i=n[1],o=Object(r.useState)([]),p=Object(l.a)(o,2),h=p[0],f=p[1],b=Object(r.useState)(!1),g=Object(l.a)(b,2),v=g[0],w=g[1],k=Object(r.useState)(!1),O=Object(l.a)(k,2),C=O[0],I=O[1],D=Object(r.useState)("default"),A=Object(l.a)(D,2),M=A[0],P=A[1],L=Object(r.useState)({_id:"",title:"",owner_email:"",owner_id:"",owner_name:"",description:"",pins:[],shared_array:[],public:!1}),N=Object(l.a)(L,2),U=N[0],z=N[1];return Object(r.useEffect)((function(){navigator.geolocation.getCurrentPosition((function(e){var t=e.coords,n=t.latitude,a=t.longitude;i([n,a])}))}),[]),Object(r.useEffect)((function(){var t={_id:Object(_.ObjectId)(e.match.params.id)};E.b.collection("MODULES").findOne(t).then((function(e){z(e);var t=[{$match:{_id:{$in:e.pins}}},{$addFields:{__order:{$indexOfArray:[e.pins,"$_id"]}}},{$sort:{__order:1}}];E.b.collection("PINS").aggregate(t).toArray().then((function(e){f(e.map((function(e){return c.a.createElement(j,{key:e._id,pin:e,setbase64data:P,base64data:M})})))}))})).catch(console.error)}),[e.match.params.id]),c.a.createElement(u.a,{center:a,zoom:13,onClick:function(e){v&&(y=e.latlng,I(!0),w(!v))}},c.a.createElement(S,{show:C,onHide:function(){return I(!1)},setMarkers:f,markers:h,setModule:z,module:U,setbase64data:P,base64data:M}),c.a.createElement("button",{style:{zIndex:1500,position:"fixed",bottom:"10px",left:"10px",textAlign:"center"},className:"btn btn-primary",onClick:function(){window.history.back()}},"Save"),c.a.createElement("button",{style:x,onClick:function(){return w(!v)}},c.a.createElement("div",{style:{fontSize:"40px"}},"+")),c.a.createElement(d.a,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'\xa9 <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}),c.a.createElement(s.a,{position:a},c.a.createElement(m.a,null,"Your location")),h)}}).call(this,n(18).Buffer)},229:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=229},441:function(e,t,n){e.exports=n(907)},445:function(e,t,n){},446:function(e,t,n){},459:function(e,t){},461:function(e,t){},471:function(e,t){},473:function(e,t){},499:function(e,t){},501:function(e,t){},502:function(e,t){},508:function(e,t){},510:function(e,t){},528:function(e,t){},531:function(e,t){},547:function(e,t){},550:function(e,t){},56:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return l}));var a=n(15),i="capstonear_app-xkqng",o=a.d.hasAppClient(i)?a.d.getAppClient(i):a.d.initializeDefaultAppClient(i),l=o.getServiceClient(a.c.factory,"mongodb-atlas").db("APP")},588:function(e,t){},590:function(e,t){},648:function(e,t,n){},651:function(e,t,n){},907:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),o=n(38),l=n.n(o),r=(n(445),n(43)),c=n(44),s=n(20),u=n(46),d=n(45),m=(n(446),n(447),n(25)),p=n.n(m),h=n(57),f=n(47),b=n(440),g=n(908),v=n(909),_=n(910),E=(n(168),n(26)),y=n.n(E),x=n(15),w=n(52),k=n(116),O=n(117);delete y.a.Icon.Default.prototype._getIconUrl,y.a.Icon.Default.mergeOptions({iconRetinaUrl:n(381),iconUrl:n(382),shadowUrl:n(383)});new y.a.Icon({iconUrl:"https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]});var j=new y.a.divIcon({className:"my-div-icon",html:'<img class="my-div-image" src="https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-green.png"/>'}),S={position:"fixed",width:"60px",height:"60px",bottom:"40px",right:"40px",backgroundColor:"#0C9",color:"#FFF",borderRadius:"50px",textAlign:"center",boxShadow:"2px 2px 3px #999",zIndex:1500},C=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;Object(r.a)(this,n),(a=t.call(this,e)).state={currentLocation:{lat:45.51,lng:-122.68},zoom:13,userLocation:[],userLocationFound:!1,modules:[],pins:[]},a.getpins=a.getpins.bind(Object(s.a)(a)),a.getUserPosition=a.getUserPosition.bind(Object(s.a)(a)),a.getDistance=a.getDistance.bind(Object(s.a)(a)),a.toRadian=a.toRadian.bind(Object(s.a)(a)),a.centerMap=a.centerMap.bind(Object(s.a)(a));var i="capstonear_app-xkqng";a.client=x.d.hasAppClient(i)?x.d.getAppClient(i):x.d.initializeDefaultAppClient(i);var o=a.client.getServiceClient(x.c.factory,"mongodb-atlas");return a.db=o.db("APP"),a}return Object(c.a)(n,[{key:"getUserPosition",value:function(){var e=this;navigator.geolocation.getCurrentPosition((function(t){e.setState({userLocation:[t.coords.latitude,t.coords.longitude],userLocationFound:!0,currentLocation:[t.coords.latitude,t.coords.longitude]}),console.log(e.state)}))}},{key:"componentDidMount",value:function(){this.getUserPosition(),this.getpins()}},{key:"getDistance",value:function(e,t){var n=this.toRadian(e[1]),a=this.toRadian(e[0]),i=this.toRadian(t[1]),o=this.toRadian(t[0]),l=o-a,r=i-n,c=Math.pow(Math.sin(l/2),2)+Math.cos(a)*Math.cos(o)*Math.pow(Math.sin(r/2),2);return 6371*(2*Math.asin(Math.sqrt(c)))*1e3<24e3}},{key:"toRadian",value:function(e){return e*Math.PI/180}},{key:"getpins",value:function(){var e=Object(f.a)(p.a.mark((function e(){var t,n,a,i=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.client.auth.isLoggedIn){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.db.collection("MODULES").find({owner_id:{$ne:this.client.auth.authInfo.userId},shared_with:{$ne:this.client.auth.authInfo.userProfile.data.email},public:!0,pins:{$ne:[]}}).asArray().then((function(e){i.setState({modules:e}),e=e.map((function(e){return e=e.pins[0]})),i.setState({pin_array:e}),console.log("Pin Array: ",e),console.log("Modules: ",i.state.modules)}));case 4:return e.next=6,this.db.collection("PINS").find({_id:{$in:Object(h.a)(this.state.pin_array)}}).toArray().then((function(e){e=e.map((function(e){return e=e.coords})),console.log("Pins: ",e),i.setState({pins:e})}));case 6:for(t=Object(h.a)(this.state.pins),n=Object(h.a)(this.state.modules),a=0;a<this.state.pins.length;a++)this.getDistance(this.state.userLocation,this.state.pins[a])||(-1!==a&&delete t[a],delete n[a]);this.setState({pins:t}),this.setState({modules:n});case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"centerMap",value:function(e,t){var n=this.refs.map.leafletElement;n.doubleClickZoom.disable(),setTimeout((function(){n.doubleClickZoom.enable()}),1e3),n.setView(t,13)}},{key:"render",value:function(){var e=this,t=this.state.userLocationFound?i.a.createElement(b.a,{position:this.state.userLocation,icon:j},i.a.createElement(g.a,null,"Your location")):null;return i.a.createElement("div",{id:"leaflet-container"},i.a.createElement(v.a,{ref:"map",center:this.state.currentLocation,zoom:13,maxZoom:18},i.a.createElement(_.a,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'\xa9 <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}),t,this.state.pins.map((function(t,n){return i.a.createElement(b.a,{key:n,position:t,icon:new y.a.divIcon({className:"my-div-icon",html:'<img class="my-div-image" src="https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-blue.png"/>'})},i.a.createElement(g.a,null,i.a.createElement("h1",null,e.state.modules[n].title),i.a.createElement("p",null,e.state.modules[n].description),i.a.createElement("p",null,e.state.modules[n].owner_name),i.a.createElement("p",null,e.state.modules[n].owner_email),i.a.createElement("button",{className:"btn btn-primary",onClick:function(){return window.location.assign("#/module/"+e.state.modules[n]._id)}},"View Details")))})),i.a.createElement("button",{style:S,onClick:function(){return e.centerMap(e,e.state.userLocation)}},i.a.createElement("div",null,i.a.createElement(k.a,{icon:O.d,size:"3x"})))))}}]),n}(a.Component),I=n(196),D=n(114),A=n(56),M=n(197),P=!0;function L(){var e=Object(I.a)(["\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    background: #343a40;\n    transform: ",";\n    height: 100vh;\n    text-align: left;\n    padding: 2rem;\n    position: fixed;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    transition: transform 0.3s ease-in-out;\n    z-index: 1501;\n\n    @media (max-width: 150px) {\n        width: 100%;\n    }\n\n    a {\n        font-size: 1.5rem;\n        text-transform: uppercase;\n        padding: 2rem 0;\n        font-weight: Light;\n        letter-spacing: 0.5rem;\n        color: #FFFFF;\n        text-decoration: none;\n        transition: color 0.3s linear;\n\n        @media (max-width: 150px) {\n            font-size: 1rem;\n            text-align: center;\n        }\n\n        &:hover {\n            color: #343078;\n        }\n    }\n"]);return L=function(){return e},e}var N=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;Object(r.a)(this,n),(a=t.call(this,e)).state={username:"",useremail:"",userID:"",stitch_res:[],menuOpen:a.props.open,usermode:P},console.log(e);var i="capstonear_app-xkqng";if(x.d.hasAppClient(i)){a.client=x.d.getAppClient(i);var o=a.client.getServiceClient(x.c.factory,"mongodb-atlas");a.db=o.db("APP")}return a}return Object(c.a)(n,[{key:"componentDidMount",value:function(){var e=Object(f.a)(p.a.mark((function e(){var t,n,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.client.auth.isLoggedIn&&this.client.auth.authInfo.userProfile&&(n=this.client.auth.authInfo.userProfile.data.first_name,a=this.client.auth.authInfo.userId,this.setState((t={username:n,userID:a,useremail:this.client.auth.authInfo.userProfile.data.email},Object(D.a)(t,"userID",this.client.auth.authInfo.userId),Object(D.a)(t,"userImg",this.client.auth.authInfo.userProfile.data.picture),t)),A.b.collection("USERS").findOne({$and:[{user_id:a},{username:n}]}).then((function(e){e||A.b.collection("USERS").findOneAndUpdate({user_id:a},{$set:{username:n}})})),console.log(this.client.auth.authInfo.userProfile.data));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"login",value:function(){var e=Object(f.a)(p.a.mark((function e(){var t;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=new x.b,this.client.auth.loginWithRedirect(t),console.log(this.state);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"logout",value:function(){var e=Object(f.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.client.auth.logout();case 2:this.setState({username:"",useremail:"",userID:""}),window.location.reload();case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"addamodule",value:function(){this.db.collection("MODULES").insertOne({owner_id:this.state.userID,name:this.state.temp_module_name,owner:this.state.useremail}).catch(console.error)}},{key:"listmymodules",value:function(){var e=this;this.client.auth.isLoggedIn&&this.db.collection("PINS").find({_id:Object(w.ObjectId)("5ebed1bc5992681f357d7948")}).asArray().then((function(t){e.setState({stitch_res:t}),console.log(e.state.stitch_res[0])}))}},{key:"set_usermode",value:function(){this.setState({usermode:P=!P})}},{key:"render",value:function(){var e=this,t=this.state.usermode?i.a.createElement("div",null,i.a.createElement("li",null,i.a.createElement("a",{href:"#/modules/student"},"View Modules")),i.a.createElement("br",null)):null,n=this.state.usermode?null:i.a.createElement("div",null,i.a.createElement("li",null,i.a.createElement("a",{href:"#/modules/instructor"},"View Modules")),i.a.createElement("br",null),i.a.createElement("li",null,i.a.createElement("a",{href:"#/modules/edit"},"Create Modules")),i.a.createElement("br",null));return i.a.createElement(U,{open:this.props.open,setOpen:this.props.setOpen,center_container:this.props.center_container,style:{}},i.a.createElement("div",{style:{position:"absolute",top:"2rem"}},i.a.createElement("img",{src:this.state.userImg,alt:"test",style:{maxHeigh:"80px",maxWidth:"80px",borderRadius:"50%",top:"1rem"}}),i.a.createElement("div",null,i.a.createElement("div",{className:"radio"},i.a.createElement("label",null,i.a.createElement("input",{style:{},type:"radio",value:"option1",checked:this.state.usermode,onClick:function(){return e.set_usermode()}}),"Student")),i.a.createElement("div",{className:"radio"},i.a.createElement("label",null,i.a.createElement("input",{type:"radio",value:"option1",checked:!this.state.usermode,onClick:function(){return e.set_usermode()}}),"Instructor"))),i.a.createElement("p",{style:{fontSize:"1.5rem",top:"4rem",color:"white",zIndex:1002}}," ","Welcome, ",i.a.createElement("br",null)," ",this.state.username," ")),i.a.createElement("ul",{style:{listStyleType:"none",paddingLeft:0},onClick:function(){e.props.center_container.center_container.current.style.opacity=1,e.props.setOpen(!e.props.open)}},i.a.createElement("li",null,i.a.createElement("a",{href:"#/"},"Home")),i.a.createElement("br",null),t,n),i.a.createElement("a",{href:"#/logout",onClick:this.logout,style:{position:"absolute",fontSize:"1rem",fontColor:"#00000",bottom:"10rem"}},"Log Out"))}}]),n}(a.Component),U=M.a.nav(L(),(function(e){return e.open?"translateX(-100)":"translateX(100%)"})),z=N,F=(n(648),function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(){var e;Object(r.a)(this,n);return(e=t.call(this)).client=x.d.getAppClient("capstonear_app-xkqng"),e.login=e.login.bind(Object(s.a)(e)),e}return Object(c.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.client.auth.hasRedirectResult()&&(console.log("has results"),this.client.auth.handleRedirectResult().then((function(t){e.setState({username:e.client.auth.authInfo.userProfile.data.name,useremail:e.client.auth.authInfo.userProfile.data.email,userID:e.client.auth.authInfo.userId}),window.location.assign("#/")})))}},{key:"login",value:function(){var e=Object(f.a)(p.a.mark((function e(){var t;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new x.b,e.next=3,this.client.auth.loginWithRedirect(t);case 3:console.log(this.state);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return i.a.createElement("div",{class:"row justify-content-center",style:{position:"fixed",margin:"auto",left:0,right:0,top:0,bottom:0,height:"50px"}},i.a.createElement("button",{class:"btn btn-primary",onClick:this.login},"Login with Google"))}}]),n}(a.Component)),R=n(198),T=n(36);function $(){var e=Object(I.a)(["\n  position: fixed;\n  top: 10px;\n  right: 2rem;\n  display: flex;\n  flex-direction: column;\n  justify-content: space-around;\n  width: 2rem;\n  height: 2rem;\n  background: transparent;\n  border: none;\n  cursor: pointer;\n  padding: 0;\n  z-index: 1502;\n\n  &:focus {\n    outline: none;\n  }\n\n  div {\n    width: 2rem;\n    height: 0.25rem;\n    background: ",";\n    border-radius: 10px;\n    transition: all 0.3s linear;\n    position: relative;\n    transform-origin: 1px;\n\n    :first-child {\n      transform: ",";\n    }\n\n    :nth-child(2) {\n      opacity: ",";\n      transform: ",";\n    }\n\n    :nth-child(3) {\n      transform: ",";\n    }\n  }\n"]);return $=function(){return e},e}var B=M.a.button($(),(function(e){e.open;return"#FFFFFF"}),(function(e){return e.open?"rotate(45deg)":"rotate(0)"}),(function(e){return e.open?"0":"1"}),(function(e){return e.open?"translateX(20px)":"translateX(0)"}),(function(e){return e.open?"rotate(-45deg)":"rotate(0)"})),G=function(e){var t=e.open,n=e.setOpen,a=e.center_container;return console.log(a.center_container.current),i.a.createElement(B,{open:t,onClick:function(){n(!t),a.center_container.current.style.opacity=t?1:.5}},i.a.createElement("div",null),i.a.createElement("div",null),i.a.createElement("div",null))},H=function(e){var t=i.a.useState(!1),n=Object(T.a)(t,2),a=n[0],o=n[1];return i.a.createElement("div",null,i.a.createElement(G,{open:a,setOpen:o,center_container:e}),i.a.createElement(z,{open:a,setOpen:o,center_container:e}))},q=n(916),Z=(n(208),function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;Object(r.a)(this,n),(a=t.call(this,e)).fileToBase64=function(e,t){return new Promise((function(n){var a=new File([e],t),i=new FileReader;i.onload=function(e){n(e.target.result)},i.readAsDataURL(a)}))},a.state={current_position:[],module_info:{name:"",owner_email:"",owner_id:"",owner_name:"",description:""},base64img:"",user:{_id:"",user_id:"",accessed_links:[]}},a.getUserPosition=a.getUserPosition.bind(Object(s.a)(a)),a.fetch_userinfo=a.fetch_userinfo.bind(Object(s.a)(a)),a.update_user=a.update_user.bind(Object(s.a)(a));var i="capstonear_app-xkqng";if(x.d.hasAppClient(i)){a.client=x.d.getAppClient(i);var o=a.client.getServiceClient(x.c.factory,"mongodb-atlas");a.db=o.db("APP"),console.log("client")}else a.client=x.d.initializeAppClient(i),console.log("client init");return a}return Object(c.a)(n,[{key:"componentDidMount",value:function(){this.getUserPosition(),this.fetch_userinfo();var e="capstonear_app-xkqng";if(x.d.hasAppClient(e)){this.client=x.d.getAppClient(e);var t=this.client.getServiceClient(x.c.factory,"mongodb-atlas");this.db=t.db("APP"),console.log("client")}else this.client=x.d.initializeAppClient(e),console.log("client init")}},{key:"fetch_userinfo",value:function(){var e=Object(f.a)(p.a.mark((function e(){var t,n=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db.collection("MODULES").find({_id:Object(w.ObjectId)(this.props.match.params.id)}).asArray().then((function(e){void 0!==e&&0!==e.length?(n.setState({module_info:e[0]}),console.log(e)):console.log(e)})).catch((function(e){n.setState({error:e}),console.log(e)}));case 2:return t={user_id:this.client.auth.authInfo.userId},e.next=5,this.db.collection("USERS").findOne(t).then((function(e){console.log("User: ",e),n.setState({user:e})})).catch(console.error);case 5:this.update_user();case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getUserPosition",value:function(){var e=this;navigator.geolocation.getCurrentPosition((function(t){e.setState({userLocation:[t.coords.latitude,t.coords.longitude],userLocationFound:!0,currentLocation:[t.coords.latitude,t.coords.longitude]}),console.log(e.state)}))}},{key:"update_user",value:function(){if(this.client.auth.authInfo.userId!=this.state.module_info.owner_id&&1==this.state.module_info.public&&!this.state.module_info.shared_with.includes(this.client.auth.authInfo.userProfile.email)){var e={_id:this.state.user._id,user_id:this.client.auth.authInfo.userId},t={$addToSet:{accessed_links:Object(w.ObjectId)(this.state.module_info._id)}};this.db.collection("USERS").findOneAndUpdate(e,t).then((function(e){console.log("Update response: ",e)})).catch(console.error)}}},{key:"renderMap",value:function(){var e=this.state.userLocationFound?i.a.createElement(b.a,{position:this.state.userLocation},i.a.createElement(g.a,null,"Your location")):null;return i.a.createElement("div",{id:"leaflet-container"},i.a.createElement(v.a,{center:this.state.currentLocation,zoom:13,maxZoom:18},i.a.createElement(_.a,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'\xa9 <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}),e))}},{key:"render",value:function(){var e=this;return i.a.createElement(q.a,null,"title:",i.a.createElement("br",null),this.state.module_info.title,i.a.createElement("br",null),i.a.createElement("br",null),"owner_email:",i.a.createElement("br",null),this.state.module_info.owner_email,i.a.createElement("br",null),i.a.createElement("br",null),"owner_name:",i.a.createElement("br",null),this.state.module_info.owner_name,i.a.createElement("br",null),i.a.createElement("br",null),"owner_id:",i.a.createElement("br",null),this.state.module_info.owner_id,i.a.createElement("br",null),i.a.createElement("br",null),"description:",i.a.createElement("br",null),this.state.module_info.description,i.a.createElement("br",null),i.a.createElement("br",null),i.a.createElement("button",{className:"btn btn-primary",onClick:function(){return window.location.assign("#/module/"+e.state.module_info._id+"/pins")}},"start module"))}}]),n}(a.Component)),K=n(89),V=n(210),W=n(917),Y=n(430),X=n(428),J=n(429),Q=n(55),ee=n(921),te=n(918),ne=n(281),ae=(n(651),function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;Object(r.a)(this,n),(a=t.call(this,e)).state={module_info:{_id:"",title:"",owner_email:"",owner_id:"",owner_name:"",description:"",pins:[],shared_with:[],public:!1},email:"",shared_with:[],pins:[],idx:-1,ind:-1,modal:null,modal2:null,copied:!1,link:""},a.fetch_userinfo=a.fetch_userinfo.bind(Object(s.a)(a)),a.show_modal=a.show_modal.bind(Object(s.a)(a)),a.show_modal2=a.show_modal2.bind(Object(s.a)(a)),a.hide_modal=a.hide_modal.bind(Object(s.a)(a)),a.hide_modal2=a.hide_modal2.bind(Object(s.a)(a)),a.delete_pin_modal=a.delete_pin_modal.bind(Object(s.a)(a)),a.share_modal=a.share_modal.bind(Object(s.a)(a)),a.list_shared=a.list_shared.bind(Object(s.a)(a)),a.add_email=a.add_email.bind(Object(s.a)(a)),a.delete_email=a.delete_email.bind(Object(s.a)(a)),a.delete_email_modal=a.delete_email_modal.bind(Object(s.a)(a)),a.copy_clipboard=a.copy_clipboard.bind(Object(s.a)(a)),a.save_pin=a.save_pin.bind(Object(s.a)(a)),a.delete_pin=a.delete_pin.bind(Object(s.a)(a)),a.list_pins=a.list_pins.bind(Object(s.a)(a)),a.module_form=a.module_form.bind(Object(s.a)(a)),a.save_pin_order=a.save_pin_order.bind(Object(s.a)(a)),a.save_module=a.save_module.bind(Object(s.a)(a));var i="capstonear_app-xkqng";a.client=x.d.hasAppClient(i)?x.d.getAppClient(i):x.d.initializeDefaultAppClient(i);var o=a.client.getServiceClient(x.c.factory,"mongodb-atlas");return a.db=o.db("APP"),a.fetch_userinfo(),a}return Object(c.a)(n,[{key:"fetch_userinfo",value:function(){var e=Object(f.a)(p.a.mark((function e(){var t,n=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={_id:Object(w.ObjectId)(this.props.match.params.id)},e.next=3,this.db.collection("MODULES").findOne(t).then((function(e){console.log("Module: ",e),n.setState({module_info:e});var t=[{$match:{_id:{$in:e.pins}}},{$addFields:{__order:{$indexOfArray:[e.pins,"$_id"]}}},{$sort:{__order:1}}];n.db.collection("PINS").aggregate(t).toArray().then((function(e){console.log("Pins: ",e),n.setState({pins:e})}))})).catch(console.error);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"copy_clipboard",value:function(){this.textArea.select(),document.execCommand("copy"),this.setState({copy:!0})}},{key:"show_modal",value:function(e){this.setState({modal:e})}},{key:"show_modal2",value:function(e){this.setState({modal2:e})}},{key:"hide_modal",value:function(){this.setState({modal:null})}},{key:"hide_modal2",value:function(){this.setState({modal2:null})}},{key:"delete_pin_modal",value:function(){var e,t=this;return e=this.state.idx<0?i.a.createElement("p",null,"Nothing to delete"):i.a.createElement("p",null,"Are you sure you want to delete"," ",i.a.createElement("b",null,this.state.pins[this.state.idx].title),"?"),i.a.createElement(K.a,{show:"delete"===this.state.modal,onHide:function(e){t.hide_modal()},style:{marginTop:"50px"}},i.a.createElement(K.a.Header,{closeButton:!0},i.a.createElement(K.a.Title,null,"Confirm Deletion")),i.a.createElement(K.a.Body,null,e),i.a.createElement(K.a.Footer,null,i.a.createElement(V.a,{variant:"danger",onClick:function(e){e.preventDefault(),t.state.idx>-1&&t.delete_pin(t.state.idx),t.hide_modal()}},"Delete")," ",i.a.createElement(V.a,{variant:"secondary",onClick:function(e){e.preventDefault(),t.hide_modal()}},"Cancel")))}},{key:"delete_email_modal",value:function(){var e,t=this;return e=this.state.ind<0?i.a.createElement("p",null,"Nothing to delete"):i.a.createElement("p",null,"Are you sure you want to delete"," ",i.a.createElement("b",null,this.state.module_info.shared_with[this.state.ind]),"?"),i.a.createElement(K.a,{show:"delete_email"===this.state.modal2,onHide:function(e){t.hide_modal2()},style:{marginTop:"50px"}},i.a.createElement(K.a.Header,{closeButton:!0},i.a.createElement(K.a.Title,null,"Confirm Deletion")),i.a.createElement(K.a.Body,null,e),i.a.createElement(K.a.Footer,null,i.a.createElement(V.a,{variant:"danger",onClick:function(e){t.state.ind>-1&&t.delete_email(t.state.ind),t.hide_modal2()}},"Delete")," ",i.a.createElement(V.a,{variant:"secondary",onClick:function(e){e.preventDefault(),t.hide_modal2()}},"Cancel")))}},{key:"add_email",value:function(){var e=this,t={_id:this.state.module_info._id},n={$addToSet:{shared_with:this.state.email}};this.db.collection("MODULES").findOneAndUpdate(t,n,{upsert:!1,returnNewDocument:!0}).then((function(t){var n=t.shared_with;e.setState({shared_with:n}),e.setState({module_info:t}),console.log("Save response: ",t)})).catch(console.error)}},{key:"delete_email",value:function(e){var t=this,n={_id:this.state.module_info._id},a={$pull:{shared_with:this.state.shared_with[e]}};this.db.collection("MODULES").findOneAndUpdate(n,a,{multi:!1,returnNewDocument:!0}).then((function(e){var n=e.shared_with;t.setState({shared_with:n,ind:-1}),t.setState({module_info:e}),console.log("Save response: ",e)})).catch(console.error)}},{key:"list_shared",value:function(){var e=this;return this.state.module_info.shared_with.map((function(t,n){return i.a.createElement("div",{key:n},i.a.createElement(W.a,{form:!0},i.a.createElement(Y.a,{xs:"8"},i.a.createElement(X.a,null,i.a.createElement(J.a,{plaintext:!0,readOnly:!0,type:"text",value:e.state.module_info.shared_with[n]}))),i.a.createElement(Y.a,null,i.a.createElement(V.a,{variant:"danger",onClick:function(t){t.preventDefault(),e.setState({ind:n}),e.show_modal2("delete_email")}},"Delete"))),e.delete_email_modal())}))}},{key:"share_modal",value:function(){var e=this;return i.a.createElement(K.a,{sz:"lg",show:"share"===this.state.modal,onHide:function(t){e.hide_modal()},style:{maxHeight:"100vh",marginTop:"50px"}},i.a.createElement(K.a.Header,{closeButton:!0},"Shared With"),i.a.createElement(K.a.Body,null,i.a.createElement("div",{style:{maxHeight:"calc(100vh - 450px)",overflowY:"auto",overflowX:"hidden"}},this.list_shared())),i.a.createElement(K.a.Footer,{style:{maxHeight:"calc(100vh - 450px)",overflowY:"auto",overflowX:"hidden"}},i.a.createElement(Q.a,{style:{position:"relative",margin:"auto"}},i.a.createElement(Q.a.Group,null,i.a.createElement(J.a,{id:"email",type:"email",value:this.state.email,onChange:function(t){var n=e.state.email;n=t.target.value,e.setState({email:n})}})),i.a.createElement(Q.a.Group,null,i.a.createElement(V.a,{variant:"primary",size:"lg",block:!0,onClick:function(t){t.preventDefault(),""!==e.state.email&&e.add_email()}},"Add"),i.a.createElement(V.a,{variant:"primary",size:"lg",block:!0,onClick:function(t){t.preventDefault(),e.hide_modal()}},"Save"),i.a.createElement(Q.a.Group,{style:{marginTop:"15px"}},i.a.createElement("textarea",{ref:function(t){return e.textArea=t},plaintext:!0,readOnly:!0,value:this.state.link,placeholder:"Sharing This Module Requires They Be Set To Public!",style:{width:"100%",height:"80px"}}),i.a.createElement(V.a,{variant:"secondary",size:"sm",block:!0,onClick:function(t){t.preventDefault(),e.setState({link:window.location.origin+window.location.pathname+"/#/module/"+e.state.module_info._id}),e.copy_clipboard()}},"Copy Link"),this.state.copy?i.a.createElement("div",{style:{color:"green"}},"Copied to clipboard!"):null)))))}},{key:"module_form",value:function(){var e=this;return i.a.createElement(Q.a,null,i.a.createElement(Q.a.Group,null,i.a.createElement(Q.a.Label,null,"Title"),i.a.createElement(Q.a.Control,{type:"title",id:"title",value:this.state.module_info.title,onChange:function(t){var n=e.state.module_info;n.title=t.target.value,e.setState({module_info:n})}})),i.a.createElement(Q.a.Group,null,i.a.createElement(Q.a.Label,null,"Description"),i.a.createElement(Q.a.Control,{as:"textarea",rows:"5",id:"description",value:this.state.module_info.description,onChange:function(t){var n=e.state.module_info;n.description=t.target.value,e.setState({module_info:n})}})),i.a.createElement(Q.a.Group,{style:{display:"flex",justifyContent:"center",marginBottom:"0"}},i.a.createElement(Q.a.Check,{inline:!0,type:"radio",label:"Public",name:"formHorizontalRadios",id:"true",checked:this.state.module_info.public,onChange:function(t){var n=e.state.module_info;n.public=!0,e.setState({module_info:n})}}),i.a.createElement(Q.a.Check,{inline:!0,type:"radio",label:"Private",name:"formHorizontalRadios",id:"false",checked:!this.state.module_info.public,onChange:function(t){var n=e.state.module_info;n.public=!1,e.setState({module_info:n})}})))}},{key:"list_pins",value:function(){var e=this;return i.a.createElement(ne.List,{values:this.state.pins,onChange:function(t){var n=t.oldIndex,a=t.newIndex,i=e.state.pins;i=Object(ne.arrayMove)(i,n,a),e.setState({pins:i})},renderList:function(e){var t=e.children,n=e.props;return i.a.createElement("ol",Object.assign({},n,{style:{display:"grid",justifyContent:"center",paddingLeft:"0px"}}),t)},renderItem:function(t){var n=t.index,a=t.props;return i.a.createElement("li",a,i.a.createElement(W.a,{style:{marginTop:"5px",marginBottom:"5px"}},i.a.createElement(Y.a,{xs:"4",style:{marginTop:"auto",marginBottom:"auto"}},e.state.pins[n].title),i.a.createElement(Y.a,null,i.a.createElement(V.a,{variant:"link",onClick:function(t){t.preventDefault(),e.setState({idx:n}),e.show_modal("edit_pin_"+n)}},"Edit")),i.a.createElement(Y.a,null,i.a.createElement(V.a,{variant:"danger",onClick:function(t){t.preventDefault(),e.setState({idx:n}),e.show_modal("delete")}},"Delete"))),i.a.createElement(R.a,{pin:e.state.pins[n],show:e.state.modal==="edit_pin_"+n,save:function(t){e.save_pin(t)},cancel:function(){return e.hide_modal()}}))}})}},{key:"save_pin",value:function(e){var t=this,n={_id:e._id},a={$set:e};this.db.collection("PINS").findOneAndUpdate(n,a).then((function(n){console.log("Pin update response: ",n);var a=t.state.pins;a[t.state.idx]=e,t.setState({pins:a}),t.hide_modal()}))}},{key:"delete_pin",value:function(e){var t=this,n={_id:this.state.pins[e]._id};this.db.collection("PINS").deleteOne(n).then((function(n){console.log("Delete response: ",n);var a=t.state.pins;a.splice(e,1),t.setState({pins:a,idx:-1})})).catch(console.error)}},{key:"save_pin_order",value:function(){var e=this.state.module_info,t=this.state.pins.map((function(e){return e._id}));e.pins=t,this.setState({module_info:e})}},{key:"save_module",value:function(){this.save_pin_order();var e={_id:this.state.module_info._id},t={$set:this.state.module_info};this.db.collection("MODULES").updateOne(e,t,{upsert:!1}).then((function(e){console.log("Save response: ",e),window.location.assign("#/modules/edit/")})).catch(console.error)}},{key:"render",value:function(){var e=this;return i.a.createElement(q.a,{style:{marginTop:"10px",maxWidth:"540px",height:"100vh"}},i.a.createElement(Q.a,{style:{height:"100%"}},i.a.createElement(ee.a,{defaultActiveKey:"Module Info",transition:!1,style:{textAlign:"center",justifyContent:"center"}},i.a.createElement(te.a,{eventKey:"Module Info",title:"Module Info"},this.module_form(),i.a.createElement(Q.a.Group,null,i.a.createElement(V.a,{variant:"primary",size:"lg",block:!0,onClick:function(t){t.preventDefault();var n=e.state.module_info._id;window.location.assign("#/module/"+n+"/pins/edit")}},"Pin Map"),i.a.createElement(V.a,{variant:"secondary",size:"lg",block:!0,onClick:function(t){t.preventDefault(),e.save_module()}},"Save")),i.a.createElement(Q.a.Group,{style:{display:"flex",justifyContent:"center"}},i.a.createElement(V.a,{variant:"primary",size:"lg",block:!0,onClick:function(t){t.preventDefault(),e.show_modal("share")}},"Share"))),i.a.createElement(te.a,{eventKey:"Pins",title:"Pins",style:{height:"100%"}},this.list_pins())),i.a.createElement(Q.a.Group,null,i.a.createElement(V.a,{variant:"primary",size:"lg",block:!0,onClick:function(t){t.preventDefault();var n=e.state.module_info._id;window.location.assign("#/module/"+n+"/pins/edit")}},"Pin Map"),i.a.createElement(V.a,{variant:"secondary",size:"lg",block:!0,onClick:function(t){t.preventDefault(),e.save_module()}},"Save")),i.a.createElement(Q.a.Group,{style:{display:"flex",justifyContent:"center"}},i.a.createElement(V.a,{variant:"primary",size:"lg",block:!0,onClick:function(t){t.preventDefault(),e.show_modal("share")}},"Share"))),this.delete_pin_modal(),this.share_modal())}}]),n}(a.Component)),ie=n(922),oe=n(925),le=n(919),re=(n(652),function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;Object(r.a)(this,n),(a=t.call(this,e)).state={modules:[],my_modules:[],shared_modules:[],img1:"",stitch_res:[],user:{_id:"",user_id:"",accessed_links:[]},accessed_modules:[]},a.module_results=null,a.goto_module_id=i.a.createRef(),a.add_module_cards=a.add_module_cards.bind(Object(s.a)(a)),a.fetch_modules=a.fetch_modules.bind(Object(s.a)(a)),a.goto_module=a.goto_module.bind(Object(s.a)(a));var o="capstonear_app-xkqng";if(x.d.hasAppClient(o)){a.client=x.d.getAppClient(o);var l=a.client.getServiceClient(x.c.factory,"mongodb-atlas");a.db=l.db("APP")}else a.client=x.d.initializeAppClient(o);return a}return Object(c.a)(n,[{key:"componentDidMount",value:function(){this.fetch_modules()}},{key:"fetch_modules",value:function(){var e=Object(f.a)(p.a.mark((function e(){var t,n,a,i=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db.collection("MODULES").find({owner_id:this.client.auth.authInfo.userId}).asArray().then((function(e){i.setState({my_modules:e,modules:{0:e,1:i.state.shared_modules,2:i.state.accessed_modules}}),console.log(i.state.my_modules)}));case 2:return e.next=4,this.db.collection("MODULES").find({shared_with:this.client.auth.authInfo.userProfile.data.email}).asArray().then((function(e){i.setState({shared_modules:e,modules:{0:i.state.my_modules,1:e,2:i.state.accessed_modules}}),console.log(e)}));case 4:return console.log(this.state.modules),t={user_id:this.client.auth.authInfo.userId},n={$setOnInsert:{accessed_links:[]}},a={returnNewDocument:!0,upsert:!0},e.next=10,this.db.collection("USERS").findOneAndUpdate(t,n,a).then((function(e){console.log("User: ",e),i.setState({user:e})})).catch(console.error);case 10:return e.next=12,this.db.collection("MODULES").find({shared_with:{$ne:this.client.auth.authInfo.userProfile.data.email},_id:{$in:Object(h.a)(this.state.user.accessed_links)},public:!0}).asArray().then((function(e){i.setState({accessed_modules:e,modules:{0:i.state.my_modules,1:i.state.shared_modules,2:e}}),console.log("Accessed: ",e)}));case 12:console.log(this.state.accessed_modules);case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"goto_module",value:function(e){window.location.assign("#/module/"+e)}},{key:"module_card",value:function(e,t){var n=this.state.user.user_id;return i.a.createElement("div",{className:"col-md-6 col-lg-4 ",key:t},i.a.createElement(oe.a,{className:"h-100",style:{display:"fixed",Width:"25rem",margin:"0.25rem",justifyContent:"center",textAlign:"center"}},i.a.createElement(oe.a.Body,null,i.a.createElement(oe.a.Img,{variant:"top",src:"https://capstoneusercontent.s3-us-west-2.amazonaws.com/"+e.pins[0]+".jpeg?versionid=latest&date="+Date.now()}),i.a.createElement(oe.a.Title,null,e.title),i.a.createElement(oe.a.Subtitle,{className:"mb-2 text-muted"},"by ",e.owner_name," (",e.owner_email,")"),i.a.createElement(oe.a.Text,null,e.description),i.a.createElement("div",{className:"btn-toolbar",style:{justifyContent:"center"}},i.a.createElement("div",{className:"btn-group mr-1",style:{paddingTop:"10px"}},i.a.createElement("button",{className:"btn btn-primary",onClick:function(){return window.location.assign("#/module/".concat(e._id))}},"View Details")),i.a.createElement("div",{className:"btn-group mr-1",style:{paddingTop:"10px"}},i.a.createElement("button",{className:"btn btn-primary",onClick:function(){window.location.assign("#/module/".concat(e._id,"/pins/?user=").concat(n))}},"Start Module"))))))}},{key:"add_module_cards",value:function(e){if(0!==this.state.modules.length){console.log(this.state.modules[e]);var t=this.state.modules[e].map(this.module_card,this);return i.a.createElement("div",{style:{top:"50px",bottom:"0px",position:"relative"},className:"container"},i.a.createElement(le.a,{style:{top:"50px"}},t))}}},{key:"render",value:function(){var e=this,t=null,n=null;"/modules/student"==this.props.location.pathname?t="Shared Modules":(t="My Modules",n=i.a.createElement(te.a,{eventKey:"My Modules",title:"My Modules"},this.add_module_cards(0)));var a=function(){var t=e.goto_module_id.current.value;try{Object(w.ObjectId)(t),window.location.assign("#/module/".concat(t))}catch(n){e.db.collection("MODULES").find({title:{$regex:t,$options:"i"}}).asArray().then((function(t){e.module_results=t.map(e.module_card,e),e.forceUpdate()}))}};return i.a.createElement("div",{style:{position:"absolute",top:"0px",bottom:"0px",width:"100%",overflowY:"scroll"}},i.a.createElement("div",{style:{top:"10px",bottom:"0px",position:"relative",height:"100vh",marginLeft:"auto",marginRight:"auto"}},i.a.createElement(ee.a,{defaultActiveKey:t,transition:!1,style:{textAlign:"center",justifyContent:"center"}},n,i.a.createElement(te.a,{eventKey:"Shared Modules",title:"Shared with me"},i.a.createElement("div",null,this.add_module_cards(1)),i.a.createElement("div",null,this.add_module_cards(2))),i.a.createElement(te.a,{eventKey:"Go To",title:"Search"},i.a.createElement(Q.a,{onSubmit:function(e){e.preventDefault(),a()}},i.a.createElement(Q.a.Group,{controlId:"formModuleId"},i.a.createElement(Q.a.Label,null,"Module"),i.a.createElement(Q.a.Control,{required:!0,type:"string",placeholder:"Enter module title or id",ref:this.goto_module_id})),i.a.createElement(V.a,{variant:"primary",style:{marginBottom:"10px"},onClick:a},"Search")),this.module_results))))}}]),n}(a.Component)),ce=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;Object(r.a)(this,n),(a=t.call(this,e)).state={modules:[],modal:!1,idx:-1},a.fetch_userinfo=a.fetch_userinfo.bind(Object(s.a)(a)),a.toggle=a.toggle.bind(Object(s.a)(a)),a.modal_message=a.modal_message.bind(Object(s.a)(a)),a.list_modules=a.list_modules.bind(Object(s.a)(a)),a.delete_module=a.delete_module.bind(Object(s.a)(a)),a.add_module=a.add_module.bind(Object(s.a)(a)),a.save_modules=a.save_modules.bind(Object(s.a)(a));var i="capstonear_app-xkqng";a.client=x.d.hasAppClient(i)?x.d.getAppClient(i):x.d.initializeDefaultAppClient(i);var o=a.client.getServiceClient(x.c.factory,"mongodb-atlas");return a.db=o.db("APP"),a.fetch_userinfo(),a}return Object(c.a)(n,[{key:"fetch_userinfo",value:function(){var e=Object(f.a)(p.a.mark((function e(){var t,n=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={owner_id:this.client.auth.authInfo.userId},e.next=3,this.db.collection("MODULES").find(t).toArray().then((function(e){console.log("Modules loaded: ",e),n.setState({modules:e})})).catch(console.error);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toggle",value:function(){var e=!this.state.modal;this.setState({modal:e})}},{key:"modal_message",value:function(){return this.state.idx<0?i.a.createElement("p",null,"Nothing to delete"):i.a.createElement("p",null,"Are you sure you want to delete"," ",i.a.createElement("b",null,this.state.modules[this.state.idx].title),"?")}},{key:"list_modules",value:function(){var e=this;return this.state.modules.map((function(t,n){return i.a.createElement("div",{key:n,className:"pt-1"},i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"col-6 offset-sm-2 col-sm-4"},i.a.createElement("input",{type:"text",value:e.state.modules[n].title,onChange:function(t){t.preventDefault();var a=Object(h.a)(e.state.modules);a[n].title=t.target.value,e.setState({modules:a})}})),i.a.createElement("div",{className:"col-6 col-sm-4"},i.a.createElement("button",{className:"btn btn-link float-right",onClick:function(t){t.preventDefault();var a=e.state.modules[n]._id;window.location.assign("#/module/"+a+"/edit")}},"Edit"),i.a.createElement("button",{className:"btn btn-danger float-right",onClick:function(t){t.preventDefault(),e.setState({idx:n}),e.toggle()}},"Delete"))))}))}},{key:"delete_module",value:function(e){var t=this,n={_id:this.state.modules[e]._id};this.db.collection("MODULES").deleteOne(n).then((function(n){console.log("Delete response: ",n);var a=Object(h.a)(t.state.modules);a.splice(e,1),t.setState({modules:a,idx:-1})})).catch(console.error)}},{key:"add_module",value:function(){var e={title:"title",owner_id:this.client.auth.authInfo.userId,owner_name:this.client.auth.authInfo.userProfile.name,owner_email:this.client.auth.authInfo.userProfile.email,description:"",pins:[],shared_with:[],public:!1};this.db.collection("MODULES").insertOne(e).then((function(e){console.log("Add response: ",e);var t=e.insertedId;window.location.assign("#/module/"+t+"/edit")})).catch(console.error)}},{key:"save_modules",value:function(){var e=this;Promise.all(this.state.modules.map((function(t){var n={_id:t._id},a={$set:{title:t.title}};return e.db.collection("MODULES").updateOne(n,a,{upsert:!1})}))).then((function(e){console.log("Save response: ",e)})).catch(console.error)}},{key:"render",value:function(){var e=this;return i.a.createElement("div",{className:"container"},i.a.createElement("form",{style:{height:"100%"},onSubmit:function(t){t.preventDefault(),e.save_modules()}},i.a.createElement("div",{style:{height:"70vh",overflowY:"scroll",overflowX:"hidden"}},this.list_modules()),i.a.createElement("div",{style:{marginTop:"10px"}},i.a.createElement("button",{className:"btn btn-primary btn-lg btn-block",onClick:function(t){t.preventDefault(),e.add_module()}},"Add Module"),i.a.createElement("button",{className:"btn btn-secondary btn-lg btn-block",onClick:function(t){t.preventDefault(),e.save_modules(),window.location.assign("#/")}},"Save"))),i.a.createElement(K.a,{show:this.state.modal,toggle:function(t){t.preventDefault(),e.toggle()},style:{marginTop:"50px"}},i.a.createElement(K.a.Header,{toggle:function(t){t.preventDefault(),e.toggle()}},"Confirm Deletion"),i.a.createElement(K.a.Body,null,this.modal_message()),i.a.createElement(K.a.Footer,null,i.a.createElement("button",{className:"btn btn-danger",onClick:function(t){t.preventDefault(),e.state.idx>-1&&e.delete_module(e.state.idx),e.toggle()}},"Delete")," ",i.a.createElement("button",{className:"btn btn-secondary",onClick:function(t){t.preventDefault(),e.toggle()}},"Cancel"))))}}]),n}(a.Component),se=n(924),ue=n(920),de=n(923),me=n(926);delete y.a.Icon.Default.prototype._getIconUrl,y.a.Icon.Default.mergeOptions({iconRetinaUrl:n(381),iconUrl:n(382),shadowUrl:n(383)});var pe=new y.a.divIcon({className:"my-div-icon",html:'<img class="my-div-image" src="https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-blue.png"/>'}),he={position:"fixed",width:"60px",height:"60px",bottom:"40px",right:"40px",backgroundColor:"#0C9",color:"#FFF",borderRadius:"50px",textAlign:"center",boxShadow:"2px 2px 3px #999",zIndex:1500},fe={position:"fixed",width:"60px",height:"60px",bottom:"40px",right:"120px",backgroundColor:"#74E4E9",color:"#000000",borderRadius:"40px",textAlign:"center",boxShadow:"2px 2px 3px #999",zIndex:1500},be={position:"fixed",width:"60px",height:"60px",bottom:"40px",right:"240px",backgroundColor:"#74E4E9",color:"#000000",borderRadius:"40px",textAlign:"center",boxShadow:"2px 2px 3px #999",zIndex:1500},ge={position:"fixed",width:"60px",height:"60px",bottom:"40px",right:"180px",backgroundColor:"#0C9",color:"#FFF",borderRadius:"50px",textAlign:"center",boxShadow:"2px 2px 3px #999",zIndex:1500},ve=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;Object(r.a)(this,n),(a=t.call(this,e)).state={currentLocation:{lat:45.51,lng:-122.68},zoom:13,userLocation:[],userLocationFound:!1,username:"",useremail:"",userID:"",stitch_res:{},pin:[],pins_line:[],pins_array:[],current_pin_index:0,finish_modal:!1},a.bounds=void 0,a.userID=a.props.location.search.split("user=")[1],a.shareUrl="".concat(window.location.host).concat(window.location.pathname,"/#/completed/").concat(a.props.match.params.id,"/").concat(a.userID),console.log("the share url",a.shareUrl);var i="capstonear_app-xkqng";a.client=x.d.hasAppClient(i)?x.d.getAppClient(i):x.d.initializeDefaultAppClient(i);var o=a.client.getServiceClient(x.c.factory,"mongodb-atlas");return a.db=o.db("APP"),a}return Object(c.a)(n,[{key:"getUserPosition",value:function(){var e=this;navigator.geolocation.getCurrentPosition((function(t){e.setState({userLocation:[t.coords.latitude,t.coords.longitude],userLocationFound:!0,currentLocation:[t.coords.latitude,t.coords.longitude]})}))}},{key:"boundingRect",value:function(e){return e.reduce((function(e,t){var n=Object(T.a)(t,2),a=n[0],i=n[1];return e[0][0]=a<e[0][0]?a:e[0][0],e[0][1]=i<e[0][1]?i:e[0][1],e[1][0]=a>e[1][0]?a:e[1][0],e[1][1]=i>e[1][1]?i:e[1][1],e}),[[90,180],[-90,-180]])}},{key:"AddPaddingToRect",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1,n=Object(T.a)(e[0],2),a=n[0],i=n[1],o=Object(T.a)(e[1],2),l=o[0],r=o[1],c=(r-i)*t,s=(l-a)*t;return[[a-s,i-c],[l+s,r+c]]}},{key:"componentDidMount",value:function(){this.getUserPosition(),this.drawpins()}},{key:"drawpins",value:function(){var e=Object(f.a)(p.a.mark((function e(){var t,n=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.client.auth.isLoggedIn){e.next=2;break}return e.abrupt("return");case 2:return t={_id:Object(w.ObjectId)(this.props.match.params.id)},e.next=5,this.db.collection("MODULES").findOne(t).then((function(e){n.setState({stitch_res:e});var t=[{$match:{_id:{$in:e.pins}}},{$addFields:{__order:{$indexOfArray:[e.pins,"$_id"]}}},{$sort:{__order:1}}];n.db.collection("PINS").aggregate(t).toArray().then((function(e){n.bounds=n.AddPaddingToRect(n.boundingRect([].concat(Object(h.a)(e.map((function(e){return e.coords}))),[n.state.currentLocation]))),n.setState({pins_array:e})}))}));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"drawlines",value:function(){if(this.state.pins_line.length>0)return i.a.createElement(se.a,{positions:this.state.pins_line,color:"red"})}},{key:"openGoogle",value:function(e){var t="http://maps.google.com?q="+e[0]+","+e[1];window.open(t,"_blank")}},{key:"centerMap",value:function(e,t){var n=this.refs.map.leafletElement;n.doubleClickZoom.disable(),setTimeout((function(){n.doubleClickZoom.enable()}),1e3),n.setView(t,13),this.refs.userloc.leafletElement.openPopup()}},{key:"nextPin",value:function(){var e=this.refs.map.leafletElement;e.doubleClickZoom.disable(),setTimeout((function(){e.doubleClickZoom.enable()}),1e3);var t=this.state.current_pin_index+1;t>=this.state.pins_array.length-1&&(t=this.state.pins_array.length-1),console.log("current pin index",this.state.current_pin_index),e.setView(this.state.pins_array[t].coords,13),this.refs[t].leafletElement.openPopup(),this.setState({current_pin_index:t})}},{key:"previousPin",value:function(){var e=this.refs.map.leafletElement;e.doubleClickZoom.disable(),setTimeout((function(){e.doubleClickZoom.enable()}),1e3);var t=this.state.current_pin_index-1;t<=0&&(t=0),e.setView(this.state.pins_array[t].coords,13),this.refs[t].leafletElement.openPopup(),this.setState({current_pin_index:t})}},{key:"currentPin",value:function(){var e=this.refs.map.leafletElement;e.doubleClickZoom.disable(),setTimeout((function(){e.doubleClickZoom.enable()}),1e3),e.setView(this.state.pins_array[this.state.current_pin_index].coords)}},{key:"toggle_modal",value:function(){var e=!this.state.finish_modal;this.setState({finish_modal:e})}},{key:"go_home",value:function(){1==P?window.location.assign("#/modules/student"):window.location.assign("#/modules/instructor")}},{key:"finish_modal",value:function(){var e=this;return i.a.createElement(K.a,{show:this.state.finish_modal,onHide:function(){return e.toggle_modal()},style:{marginTop:"50px"}},i.a.createElement(K.a.Header,{closeButton:!0},i.a.createElement(K.a.Title,null,"Finish Module")),i.a.createElement(K.a.Body,null,"You finished ",this.state.stitch_res.title,i.a.createElement(de.a,{quote:"title",url:this.shareUrl},i.a.createElement(me.a,null)),i.a.createElement(Q.a,{style:{position:"relative",margin:"auto"}},i.a.createElement(Q.a.Group,null),i.a.createElement(Q.a.Group,null,i.a.createElement(V.a,{block:!0},"Scan QR")),i.a.createElement(Q.a.Group,null,i.a.createElement(V.a,{block:!0,onClick:function(){return e.go_home()}},"End Module")))),i.a.createElement(K.a.Footer,null,i.a.createElement(V.a,{variant:"secondary",onClick:function(){return e.toggle_modal()}},"Cancel")))}},{key:"render",value:function(){var e=this,t=this.state.userLocationFound?i.a.createElement(b.a,{ref:"userloc",position:this.state.userLocation,icon:pe},i.a.createElement(g.a,null,"You are here")):null;return i.a.createElement("div",null,i.a.createElement(v.a,{ref:"map",center:this.state.currentLocation,zoom:13,maxZoom:18},i.a.createElement(_.a,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'\xa9 <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}),t,this.state.pins_array.map((function(t,n){var a,o=e.state.pins_array.length;return a=n==e.state.current_pin_index?new y.a.divIcon({className:"my-div-icon",html:'<img class="my-div-image" src="https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-yellow.png"/>'}):new y.a.divIcon({className:"my-div-icon",html:'<img class="my-div-image" src="https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-green.png"/>'}),i.a.createElement(b.a,{key:n,position:t.coords,icon:a,ref:n},i.a.createElement(g.a,null,i.a.createElement("h1",null,t.title),i.a.createElement("p",null,t.description),i.a.createElement("p",null,t.hint),i.a.createElement("p",null,t.destination),i.a.createElement("img",{style:{height:"auto",width:"100%"},src:"https://capstoneusercontent.s3-us-west-2.amazonaws.com/"+t._id.toString()+".jpeg?versionid=latest&date="+Date.now()}),i.a.createElement(Q.a,{style:{paddingTop:"10px"}},function(){if(n===o-1)return i.a.createElement(Q.a.Group,null,i.a.createElement(V.a,{onClick:function(){return e.toggle_modal()},block:!0},"Finish Module"))}(),i.a.createElement(Q.a.Group,null,i.a.createElement(V.a,{onClick:function(){return e.openGoogle(t.coords)},variant:"secondary",block:!0},"Open Google Map")))))})),i.a.createElement("button",{style:he,onClick:function(){return e.centerMap(e,e.state.currentLocation)}},i.a.createElement("div",null,i.a.createElement(k.a,{icon:O.d,size:"3x"}))),i.a.createElement(ue.a,null,i.a.createElement("button",{style:fe,onClick:function(){return e.nextPin()}},i.a.createElement("div",null,i.a.createElement(k.a,{icon:O.b,size:"3x"}))),i.a.createElement("button",{style:be,onClick:function(){return e.previousPin()}},i.a.createElement("div",null,i.a.createElement(k.a,{icon:O.a,size:"3x"}))),i.a.createElement("button",{style:ge,onClick:function(){return e.currentPin()}},i.a.createElement("div",null,i.a.createElement(k.a,{icon:O.c,size:"3x"}))))),this.finish_modal())}}]),n}(a.Component),_e=n(37),Ee=function(e){return"https://capstoneusercontent.s3-us-west-2.amazonaws.com/".concat(e,".jpeg?versionid=latest")},ye=function(e){var t=Object(a.useState)(),n=Object(T.a)(t,2),o=n[0],l=n[1],r=Object(a.useState)("User"),c=Object(T.a)(r,2),s=c[0],u=c[1],d=Object(_e.f)(),m=d.module,p=d.userid;return Object(a.useEffect)((function(){A.b.collection("MODULES").findOne({_id:Object(w.ObjectId)(m)}).then((function(e){return l(e.pins[0])})),A.b.collection("USERS").findOne({user_id:p}).then((function(e){return u((null===e||void 0===e?void 0:e.username)||s)}))}),[]),i.a.createElement("div",{className:"container",style:{display:"block",marginLeft:"auto",marginRight:"auto",textAlign:"center"}},i.a.createElement("h1",null," ","".concat(s," has completed this module")," "),i.a.createElement("img",{src:Ee(o),style:{width:"90%"}}))},xe=n(278),we=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var a;Object(r.a)(this,n),(a=t.call(this,e)).Home=function(){return a.client.auth.isLoggedIn?i.a.createElement("div",null,i.a.createElement(C,null)):i.a.createElement(F,null)},a.NavMenu=function(){if(a.client.auth.isLoggedIn)return i.a.createElement(H,{center_container:a.center_container})};var o="capstonear_app-xkqng";return a.client=x.d.hasAppClient(o)?x.d.getAppClient(o):x.d.initializeDefaultAppClient(o),a.client.auth.hasRedirectResult()&&a.client.auth.handleRedirectResult().then((function(e){window.location.assign("/")})),a.state={isLoggedIn:!1},a.center_container=i.a.createRef(),a.NavMenu=a.NavMenu.bind(Object(s.a)(a)),a}return Object(c.a)(n,[{key:"componentDidMount",value:function(){}},{key:"handleStitchClient",value:function(){this.setState({stitchClient:this.client,userProfile:this.client.auth.userProfile,isLoggedIn:!0})}},{key:"render",value:function(){return i.a.createElement(xe.a,{basename:"/"},i.a.createElement("div",null,i.a.createElement(ie.a,{className:"navbar bg-dark navbar-dark",style:{position:"fixed",width:"100%",height:"50px",zIndex:1500}},i.a.createElement(ie.a.Brand,{href:"#/"},"Context AR")),this.NavMenu()),i.a.createElement("div",{ref:this.center_container,className:"center_container",style:{position:"fixed",top:"50px",bottom:"0",width:"100%",height:"calc(100% - 50px)"}},i.a.createElement(_e.c,null,i.a.createElement(_e.a,{exact:!0,path:"/menu",component:z}),i.a.createElement(_e.a,{exact:!0,path:"/modules/edit",component:ce}),i.a.createElement(_e.a,{exact:!0,path:"/modules/student",component:re}),i.a.createElement(_e.a,{exact:!0,path:"/modules/instructor",component:re}),i.a.createElement(_e.a,{exact:!0,path:"/module/:id/pins/edit",component:R.b}),i.a.createElement(_e.a,{exact:!0,path:"/module/:id/pins",component:ve}),i.a.createElement(_e.a,{path:"/completed/:module/:userid"},i.a.createElement(ye,null)),i.a.createElement(_e.a,{exact:!0,path:"/module/:id/edit",component:ae}),i.a.createElement(_e.a,{path:"/module/:id",component:Z}),i.a.createElement(_e.a,{exact:!0,path:"/"},this.Home))))}}]),n}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(i.a.createElement(we,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[441,1,2]]]);
//# sourceMappingURL=main.25889dfc.chunk.js.map